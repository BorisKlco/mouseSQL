# postgresql.conf - Custom performance settings

# --- Memory Settings ---
# Set to 25% of the container's dedicated RAM. For 8GB, 2GB is a good start.
shared_buffers = 2GB
# This tells the planner how much memory is available for caching by both
# Postgres and the OS. Set to ~75% of the container's dedicated RAM.
effective_cache_size = 6GB
# Memory for maintenance tasks like VACUUM, CREATE INDEX.
maintenance_work_mem = 512MB
# Memory used per-query for sorts, hashes, etc. Be careful not to set this
# too high if you have many concurrent connections.
work_mem = 32MB

# --- Checkpoint Settings ---
# Spread checkpoint writes over a longer period to reduce I/O spikes.
checkpoint_completion_target = 0.9
# Increase the amount of WAL data before a checkpoint is triggered.
max_wal_size = 2GB
min_wal_size = 512MB

# --- Planner Settings ---
# For modern SSDs, random I/O is not much more expensive than sequential.
# This encourages the planner to use indexes more often. Default is 4.0.
random_page_cost = 1.1
# Increases the cost of CPU work, making the planner favor I/O-heavy plans
# a bit less. Good for CPU-bound queries.
cpu_tuple_cost = 0.03

# --- Logging ---
# Optional: Uncomment to log slow queries (e.g., queries longer than 250ms)
# log_min_duration_statement = 250ms

# --- Connections ---
# Allow connections from any IP address. This is controlled by pg_hba.conf,
# but Postgres needs to be listening on the correct interface.
listen_addresses = '*'